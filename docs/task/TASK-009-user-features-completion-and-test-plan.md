# TASK-009 用户侧功能补全（Epic：拆分任务总览）

> 定位：本项目为影评系统（类似豆瓣），重点在“电影条目 + 收藏/想看/看过 + 短评评分 + 用户影评 + 搜索与推荐”。不做站内在线播放/离线下载电影。

## 任务内容
- 要做什么：
  - 将用户侧未完成能力拆分为多个可独立交付、可独立验收、可独立回归的 Task。
  - 明确各 Task 的依赖关系、里程碑与统一测试/发布回归口径。
- 为什么要做（背景/问题）：
  - 原先单个 TASK-009 覆盖面过大，难以并行推进与验收；拆分后便于聚焦、降低风险、提高可回归性。
- 目标（可量化）：
  - 条目行为（收藏/想看/看过）、短评评分、长评影评、搜索推荐均有独立任务与验收标准。
  - 每个任务具备“过程验证 + 最终验收 + 回归范围”，发布前按统一 Runbook 执行并留痕。
- 范围（包含/不包含）：
  - 包含：用户侧功能补全及其测试体系（文档层面）。
  - 不包含：站内播放/下载；管理员封禁/投诉处理/报表等（另立任务）。

## 拆分后的任务清单（建议执行顺序）

0) 说明（本阶段暂缓项）
- 账号体系安全增强、全局隐私/越权专项暂缓：本阶段沿用现有登录与拦截能力，不在任务清单内单独推进，也不作为发布阻断级测试项（避免范围失控）。

1) 收藏与观影状态（想看/看过）
- `docs/task/TASK-010-favorites-and-watch-status.md`
- 内容：按用户隔离、幂等、列表倒序、与短评/影评联动规则。

2) 短评与评分（最小审核 + 内容安全）
- `docs/task/TASK-011-short-reviews-and-ratings.md`
- 内容：短评/评分发布与展示、可见性状态机、内容安全、（可选）点赞。
- 依赖：TASK-010。

3) 用户影评（长评）
- `docs/task/TASK-012-user-long-reviews.md`
- 内容：影评写作、草稿/发布、可见性状态机、权限边界、内容安全（外链/图片策略对齐 TASK-007）。
- 依赖：TASK-010。

4) 搜索增强与推荐
- `docs/task/TASK-013-search-and-recommendations.md`
- 内容：多维搜索、自动补全、可解释推荐、相关推荐。
- 依赖：TASK-010~TASK-012（推荐可利用用户行为）；可先做“新用户默认推荐”再做个性化。

5) 测试策略与发布回归 Runbook（统一口径）
- `docs/task/TASK-014-testing-strategy-and-runbook.md`
- 内容：测试分层、阻断标准、统一数据口径、发布前必跑流程与留痕要求。
- 说明：该任务应尽早定版，作为其他任务验收与发布的统一入口。

## 过程验证
- 每个拆分任务按其文档中的“过程验证”执行，并产出记录（缺陷、复现、修复验证、是否放行）。
- P0 阻断项以 `TASK-014` 为准（本阶段重点关注：跨用户数据泄露、待审内容对外可见、XSS 可执行等高风险项）。

## 最终结果验证
- 验收项：
  - TASK-010~TASK-014 全部通过各自验收项。
  - 用户侧主链路可完成：登录（沿用现有能力）-> 找电影 -> 收藏/想看/看过 -> 短评评分/影评 -> 搜索/推荐。
- 回归范围：
  - 以 TASK-014 的 Runbook 与 P0/P1 用例矩阵为准。

## 风险与回滚
- 风险点：
  - 任务并行导致接口契约不一致；内容安全策略不一致导致 XSS 风险；回归口径不统一导致“验收通过但上线出问题”。
- 规避手段：
  - 先定版 TASK-014 的关键口径；接口契约评审后再进入实现；每个任务必须产出回归清单与验收记录。
- 回滚策略：
  - 按模块提供功能开关或入口开关（文档描述即可），优先保证“登录与核心浏览”可用；高风险功能（发布短评/影评）可临时关闭入口但保留数据。

## 里程碑 / 截止时间（建议）
- M1：TASK-014（统一回归口径）定版并验收通过
- M2：TASK-010（收藏/想看/看过）闭环
- M3：TASK-011（短评评分）闭环
- M4：TASK-012（用户影评）闭环
- M5：TASK-013（搜索增强/推荐）闭环
- 全程：TASK-014 作为统一回归入口，持续更新

## 关联信息
- 参考：`docs/FEATURES_IMPLEMENTED_CHECKLIST.md`
- 相关任务：
  - `docs/task/TASK-007-remote-image-audit.md`
  - `docs/task/TASK-008-redis-cache-layer.md`
